# Makefile for ePIC Adventures
include ../../../Tools/Variables.mk

# The SOFTWARE_PATH and PROGRAM_OBJECTS_PATH variables are mandatory
SOFTWARE_PATH = ../..
PROGRAM_OBJECTS_PATH = $(TEXT_GAMES_SYSTEM_OBJECTS_PATH)/ePIC_Adventures
OBJECTS = $(PROGRAM_OBJECTS_PATH)/main.obj
BINARY = ePIC_Adventures
EEPROM_IMAGE = $(TEXT_GAMES_SYSTEM_BINARIES_PATH)/ePIC_Adventures_EEPROM_Image.bin

all: Strings.h $(EEPROM_IMAGE) $(OBJECTS)
	$(TEXT_GAMES_SYSTEM_LD) $(TEXT_GAMES_SYSTEM_LDFLAGS) $(OBJECTS) -d $(PROGRAM_OBJECTS_PATH) -p $(BINARY)
	@cp $(PROGRAM_OBJECTS_PATH)/$(BINARY).hex $(TEXT_GAMES_SYSTEM_BINARIES_PATH) > /dev/null
	
Strings.h: help/Strings.txt
	$(TEXT_GAMES_SYSTEM_EEPROM_STRINGS_CONVERTER) help/Strings.txt Strings.h $(EEPROM_IMAGE) $(TEXT_GAMES_SYSTEM_EEPROM_SIZE)
	
$(EEPROM_IMAGE): help/Strings.txt
	$(TEXT_GAMES_SYSTEM_EEPROM_STRINGS_CONVERTER) help/Strings.txt Strings.h $(EEPROM_IMAGE) $(TEXT_GAMES_SYSTEM_EEPROM_SIZE)
	
$(PROGRAM_OBJECTS_PATH)/main.obj: main.c characters.h gui.h help/Strings.txt interactions.h items.h tools.h
	$(TEXT_GAMES_SYSTEM_CC) $(TEXT_GAMES_SYSTEM_CCFLAGS) main.c

clean:
	rm -f $(PROGRAM_OBJECTS_PATH)/* $(TEXT_GAMES_SYSTEM_BINARIES_PATH)/$(BINARY).hex $(EEPROM_IMAGE)
	
download:
	$(TEXT_GAMES_SYSTEM_TOOLS_PATH)/Programmer/Programmer.exe $(TEXT_GAMES_SYSTEM_BINARIES_PATH)/$(BINARY).hex $(EEPROM_IMAGE) $(TEXT_GAMES_SYSTEM_PROGRAMMER_UART_DEVICE_NAME)
